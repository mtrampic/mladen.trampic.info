{{ partial "consent-banner.html" . }}

{{ if .Page.Store.Get "hasMermaid" }}
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
  // Detect theme and update Mermaid
  function updateMermaidTheme() {
    const isDark = document.documentElement.classList.contains('dark') || 
                   document.documentElement.getAttribute('data-theme') === 'dark' ||
                   window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    const config = {
      startOnLoad: true,
      theme: 'base',
      themeVariables: {
        background: 'transparent',
        primaryColor: 'transparent',
        primaryTextColor: isDark ? '#ffffff' : '#000000',
        primaryBorderColor: isDark ? '#ffffff' : '#000000',
        lineColor: isDark ? '#ffffff' : '#000000',
        secondaryColor: 'transparent',
        tertiaryColor: 'transparent',
        clusterBkg: 'transparent',
        clusterBorder: isDark ? '#ffffff' : '#000000',
        fontWeight: '600'
      }
    };
    
    mermaid.initialize(config);
  }
  
  // Initialize on load
  updateMermaidTheme();
  
  // Watch for theme changes
  const observer = new MutationObserver(updateMermaidTheme);
  observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class', 'data-theme'] });
</script>
<style>
.mermaid text {
  font-weight: 600 !important;
}
</style>
{{ end }}
